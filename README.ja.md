# EDS Site Inspector

Edge Delivery Services (EDS) ページを検査・分析するためのChrome拡張機能。ページ上でセクション、ブロック、関連するソースアセットを可視化します。

## 機能

### 🎯 ビジュアルオーバーレイ検査

- **セクションオーバーレイ**: ページのセクションを境界線付きで可視化
- **ブロックオーバーレイ**: ページ上の個々のブロックを識別・ハイライト表示
- **デフォルトコンテンツオーバーレイ**: デフォルトコンテンツ領域を表示

すべてのオーバーレイは、拡張機能のポップアップまたはDevToolsパネルから個別に切り替え可能です。

### 📊 DevToolsパネル

Chrome DevToolsを開き、「EDS Site Inspector」タブに移動すると、詳細な分析が可能です：

#### Controlタブ
- オーバーレイの切り替え（セクション、ブロック、デフォルトコンテンツ）
- ページ分析の更新
- ページ統計の表示

#### Blocksタブ
- 検出されたすべてのブロックをカテゴリ別に閲覧：
  - Block（汎用ブロック）
  - Heading、Text、Image、List
  - Code、Table、Quote
  - Media、Button、Icon
- 任意のブロックをクリックして詳細情報を表示：
  - ブロック名とカテゴリ
  - ソースコード（HTML）
  - 関連するJavaScriptファイル
  - 関連するメディアファイル
  - ブロックメタデータ

#### Scriptsタブ
- ページで読み込まれたすべてのJavaScriptファイルを表示
- スクリプトのフィルタリングと検索
- 新しいタブでスクリプトを開く

#### JSONタブ
- ページで取得されたすべてのJSONファイルを閲覧
- シンタックスハイライト付きでJSONコンテンツを表示
- JSONファイルの検索とフィルタリング

#### Mediaタブ
- Media Busから取得されたすべてのメディアファイル（画像、動画など）を表示
- メディアのサムネイルをプレビュー
- 新しいタブでメディアファイルを開く

#### Iconsタブ
- ページで使用されているすべてのアイコンを閲覧
- アイコン名とソースを表示
- アイコンの使用箇所を確認

#### Docs (SSR)タブ
- サーバーサイドレンダリング（SSR）されたドキュメントを表示
- クライアントサイドのハイドレーション前のHTML構造を検査
- SSRとライブDOMを比較

#### Exploreタブ
- EDSで構築されたサイトのキュレーションリストを閲覧
- サンプルサイトへのクイックナビゲーション
- タイトルまたはURLでサイトを検索

### 🔄 自動更新

- ナビゲーション時にページを自動的に再分析
- SPA（シングルページアプリケーション）のルート変更を検出
- ナビゲーション中もオーバーレイの状態を維持

### 🎨 ユーザーフレンドリーなインターフェース

- クイックオーバーレイ制御のためのクリーンなポップアップインターフェース
- 詳細な検査のための包括的なDevToolsパネル
- ポップアップとDevToolsパネル間で同期された状態

## インストール

### ソースからインストール

1. リポジトリをクローン：
   ```bash
   git clone <repository-url>
   cd eds-site-inspector
   ```

2. 依存関係をインストール：
   ```bash
   npm install
   ```

3. 拡張機能をビルド：
   ```bash
   npm run build
   ```

4. Chromeに拡張機能を読み込む：
   - Chromeを開き、`chrome://extensions/`に移動
   - 「デベロッパーモード」を有効化（右上のトグル）
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - このプロジェクトの`dist/`ディレクトリを選択

## 使い方

### クイックスタート

1. Edge Delivery Servicesで構築されたウェブサイトに移動
2. ChromeツールバーのEDS Site Inspector拡張機能アイコンをクリック
3. チェックボックスを使用してオーバーレイを切り替え（セクション、ブロック、デフォルトコンテンツ）
4. Chrome DevTools（F12）を開き、「EDS Site Inspector」タブに移動して詳細な分析を実行

### ポップアップの使用

拡張機能のポップアップから、オーバーレイコントロールにすばやくアクセスできます：
- **Sections**: セクション境界の表示/非表示
- **Blocks**: ブロック境界の表示/非表示
- **Default Content**: デフォルトコンテンツ領域の表示/非表示

### DevToolsパネルの使用

DevToolsパネルは包括的な分析ツールを提供します：

1. **Controlタブ**: オーバーレイの管理と分析の更新
2. **Blocksタブ**: 個々のブロックの閲覧と検査
3. **Scriptsタブ**: すべてのJavaScriptファイルの表示
4. **JSONタブ**: JSONデータファイルの検査
5. **Mediaタブ**: メディアアセットの閲覧
6. **Iconsタブ**: アイコンの使用状況の表示
7. **Docsタブ**: SSRドキュメントの検査
8. **Exploreタブ**: EDSで構築されたサイトの発見

### ブロック検査

1. DevToolsパネルを開く
2. 「Blocks」タブに移動
3. 任意のブロックをクリックして詳細を表示：
   - ソースHTMLコード
   - 関連するJavaScriptファイル
   - 関連するメディアファイル
   - ブロックメタデータ

## 開発

### ビルド

```bash
npm run build
```

### ウォッチモード

ファイル変更時に自動的に再ビルド：

```bash
npm run watch
```

### テスト

このプロジェクトはテストに[Vitest](https://vitest.dev/)を使用しています。

```bash
# すべてのテストを実行
npm test

# ウォッチモードでテストを実行
npm test -- --watch

# UI付きでテストを実行
npm run test:ui

# カバレッジ付きでテストを実行
npm run test:coverage
```

### テストカバレッジ

- HTMLフォーマットとインデント（`code-processor.js`）
- ブロック検出ロジック（`blocks.js`）
- ファイルタイプ検出

## プロジェクト構造

```
src/
├── background.js          # サービスワーカー
├── content.js            # コンテンツスクリプトのエントリーポイント
├── popup.js              # ポップアップスクリプト
├── panel.js              # DevToolsパネルスクリプト
├── content/              # コンテンツスクリプトモジュール
│   ├── analyzer.js       # ページ分析ロジック
│   ├── detectors/        # 検出モジュール（ブロック、セクション、アイコン）
│   ├── collectors/       # データ収集モジュール
│   ├── overlay/          # オーバーレイ管理
│   └── api/              # API統合
└── panel/                # DevToolsパネルモジュール
    ├── renderers/        # タブレンダラー
    └── utils/            # ユーティリティ関数
```

## 要件

- Chromeブラウザ（Manifest V3対応）
- Node.js 14+（開発用）
- npmまたはyarn

## 権限

この拡張機能には以下の権限が必要です：
- `scripting`: コンテンツスクリプトを注入するため
- `activeTab`: 現在のタブと対話するため
- `storage`: オーバーレイの設定を保存するため
- `tabs`: タブを管理するため
- `<all_urls>`: 任意のウェブサイトを分析するため

## ライセンス

ISC

## 貢献

貢献を歓迎します！プルリクエストを自由に提出してください。

